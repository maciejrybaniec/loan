angular.module("bsApp",["ui-rangeSlider","ui-notification","bsApp.main","bsApp.track","bsApp.notification","bsApp.compare-service","bsApp.RatingDirective"]).constant("appConfig",{apiUrl:"http://bankierski.pl/api"}),angular.module("bsApp.main",["bsApp.compare-service","bsApp.provider-service","ui-rangeSlider"]).controller("CompareCtrl",["$scope","$rootScope","compareService","providerService",function(i,e,o,t){i.searchArguments={},i.visibleDetails=[],i.loanProviders=[],i.firstTimeBorrow=!1,i.providersLoad=!1,i.compareTrigger=!1,i.showDetailsNotification=!1,i.isFormPending=!1,i.notificationDetails={},i.setDefaultNotificationsValue=function(){i.notifications={conditions:!1,email:""},i.allowFormSend=!0,i.notificationError={}},i.setDefaultSliderValues=function(){i.amount={value:700,maxValue:1e4,minValue:100},i.time={value:15,maxValue:60,minValue:1}},i.onSendDetails=function(e){i.notificationDetails=i.loanProviders[e],i.setDefaultNotificationsValue(),i.showDetailsNotification=!0},i.onClosePopup=function(){i.showDetailsNotification=!1},i.onSendMessage=function(){if(i.notificationError={},i.allowFormSend&&i.isValidPopupForm()){i.isFormPending=!0;var o=t.sendDetailsNotification(i.notifications.email,i.notificationDetails.provider,i.notificationDetails._id);i.allowFormSend=!1,o.then(function(o){var t={type:"success",message:"Wiadomość została wysłana na Twoją skrzynkę e-mail"};i.isFormPending=!1,e.$broadcast("notification",t),i.showDetailsNotification=!1,i.allowFormSend=!0},function(){var o={type:"error",message:"Wysyłanie wiadomości zakończyło się niepowodzeniem"};i.isFormPending=!1,e.$broadcast("notification",o),i.showDetailsNotification=!1,i.allowFormSend=!0})}},i.isValidPopupForm=function(){var e=i.regexMail(),o=!0;return 0!==i.notifications.email.length&&null!==e.exec(i.notifications.email)||(i.notificationError.email="Wprowadzono niepoprawny adres e-mail",o=!1),i.notifications.conditions===!1&&(i.notificationError.conditions="Musisz zaakceptować powyższe warunki użytkowania",o=!1),o},i.regexMail=function(){return/(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/},i.toggleDetails=function(e,o){var t=o.currentTarget,a=t.getAttribute("data-render"),n=t.getAttribute("data-provider");t.parentNode.nodeName;JSON.parse(a)?i.setDetailClass(e):i.getProviderDetails(t,e,n)},i.getProviderDetails=function(e,o,a){var n=t.getProviderDetail(a);n.then(function(t){e.setAttribute("data-render",!0),i.setDetailClass(o),i.extendProvider(a,t)})},i.extendProvider=function(e,o){var a=t.findProvider(i.loanProviders,"provider",e);i.loanProviders[a].details=o},i.setDetailClass=function(e){i.visibleDetails[e]="bs-visible-details"==i.visibleDetails[e]?"":"bs-visible-details"},i.onLoanCompare=function(){var e=document.getElementsByTagName("body")[0];e.setAttribute("data-compare",!0),i.visibleDetails=[];var t={time:i.time.value,amount:i.amount.value,firstTimeBorrow:i.firstTimeBorrow};i.compareTrigger=!0,i.providersLoad=!0,o.getLoanProviders(t,i.onCompareReturn)},i.onCompareReturn=function(e){i.providersLoad=!1,e===!1||(i.searchArguments.value=i.amount.value,i.searchArguments.time=i.time.value,i.loanProviders=e.sort(function(i,e){return i.total-e.total}))},i.increaseAmount=function(){i.amount.value!==i.amount.maxValue&&(i.amount.value+=i.amount.minValue)},i.decreaseAmount=function(){i.amount.value!==i.amount.minValue&&(i.amount.value-=i.amount.minValue)},i.increaseTime=function(){i.time.value!==i.time.maxValue&&(i.time.value+=i.time.minValue)},i.decreaseTime=function(){i.time.value!==i.time.minValue&&(i.time.value-=i.time.minValue)},i.setDefaultSliderValues(),i.setDefaultNotificationsValue()}]),angular.module("bsApp.notification",["ui-notification"]).config(["NotificationProvider",function(i){i.setOptions({delay:1e4,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"bottom"})}]).controller("NotificationCtrl",["$scope","$timeout","Notification",function(i,e,o){var t=["Vivus","NetCredit","Filarum","Kobieta z Kasą","Ferratum Bank","SohoCredit","EkspresKasa"],a=["chwilę temu","5 minut temu","10 minut temu","15 minut temu","w tej chwili"],n=[400,500,600,800,900,1100,1500,2100,2700,3e3],r=1e3*Math.floor(100*Math.random()+1);e(function(){var i=Math.floor(Math.random()*a.length+0),e=Math.floor(Math.random()*n.length+0),r=Math.floor(Math.random()*t.length+0);o.info({delay:5500,message:"<strong>"+a[i]+" </strong> klient złożył wniosek o pożyczkę "+n[e]+" zł w <strong>"+t[r]+"</strong>",positionY:"bottom",positionX:"left"})},r),i.$on("notification",function(i,e){o[e.type](e.message)})}]),angular.module("bsApp.track",["ngCookies"]).controller("TrackCtrl",["$scope","$cookies",function(i,e){i.showCookieLaw=!1,i.isAcceptedCookieLaw=function(){var o=e.get("bsCookieInfo");void 0===o&&(i.showCookieLaw=!0)},i.onCloseCookies=function(){i.showCookieLaw=!1},i.onAcceptCookies=function(){e.put("bsCookieInfo",!0),i.showCookieLaw=!1},i.isAcceptedCookieLaw()}]),angular.module("bsApp.RatingDirective",[]).directive("ratingElement",function(){return{restrict:"E",link:function(i,e,o){i.rating=o.rating},templateUrl:"/assets/templates/rating-element.html"}}),angular.module("bsApp.compare-service",[]).service("compareService",["$http","appConfig",function(i,e){function o(o,t){i({method:"POST",data:o,url:e.apiUrl+"/compare"}).then(function(i){t(i.data)},function(i){t(!1)})}return{getLoanProviders:o}}]),angular.module("bsApp.provider-service",[]).service("providerService",["$http","$q","appConfig",function(i,e,o){function t(t){var a=e.defer();return i({method:"POST",data:{provider:t},url:o.apiUrl+"/detail"}).then(function(i){a.resolve(i.data)},function(i){a.reject(i)}),a.promise}function a(t,a,n){var r=e.defer();return i({method:"POST",data:{email:t,provider:a,id:n},url:o.apiUrl+"/notification"}).then(function(i){r.resolve(i.data)},function(i){r.reject(i)}),r.promise}function n(i,e,o){for(var t=0;t<i.length;t+=1)if(i[t][e]===o)return t}return{getProviderDetail:t,sendDetailsNotification:a,findProvider:n}}]);